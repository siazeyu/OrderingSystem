<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜²é‡å¤æäº¤åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .submitting {
            position: relative;
            pointer-events: none;
            opacity: 0.7;
        }
        .submitting::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            margin: -6px 0 0 -6px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>é˜²é‡å¤æäº¤åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1: æŒ‰é’®é˜²é‡å¤æäº¤</h2>
        <p>å¿«é€Ÿè¿ç»­ç‚¹å‡»æŒ‰é’®ï¼Œè§‚å¯ŸæŒ‰é’®çŠ¶æ€å˜åŒ–</p>
        <button class="test-button" onclick="testButtonSubmit(this)">æµ‹è¯•æŒ‰é’®æäº¤</button>
        <div id="buttonLog" class="log"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•2: è¡¨å•é˜²é‡å¤æäº¤</h2>
        <p>å¿«é€Ÿè¿ç»­æäº¤è¡¨å•ï¼Œè§‚å¯Ÿè¡¨å•çŠ¶æ€å˜åŒ–</p>
        <form id="testForm" onsubmit="testFormSubmit(event, this)">
            <input type="text" placeholder="æµ‹è¯•è¾“å…¥" required>
            <button type="submit" class="test-button">æäº¤è¡¨å•</button>
        </form>
        <div id="formLog" class="log"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•3: åŠ è½½æç¤ºåŠŸèƒ½</h2>
        <p>æµ‹è¯•å…¨å±€åŠ è½½æç¤ºå’ŒæŒ‰é’®åŠ è½½çŠ¶æ€</p>
        <button class="test-button" onclick="testLoading(this)">æµ‹è¯•åŠ è½½æç¤º</button>
        <div id="loadingLog" class="log"></div>
    </div>

    <script src="js/api.js"></script>
    <script>
        let logCount = 0;

        function addLog(containerId, message) {
            const logContainer = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ¡æ•°
            if (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // æµ‹è¯•æŒ‰é’®é˜²é‡å¤æäº¤
        async function testButtonSubmit(button) {
            addLog('buttonLog', `æŒ‰é’®ç‚¹å‡»å¼€å§‹ - ç¬¬${++logCount}æ¬¡`);
            
            // åº”ç”¨é˜²é‡å¤æäº¤
            if (!submitManager.canSubmit(button)) {
                addLog('buttonLog', 'âŒ æŒ‰é’®è¢«é˜»æ­¢ï¼Œæ­£åœ¨æäº¤ä¸­...');
                return;
            }
            
            submitManager.setButtonSubmitting(button, true, 'æäº¤ä¸­...');
            addLog('buttonLog', 'âœ… æŒ‰é’®å¼€å§‹æäº¤ï¼ŒçŠ¶æ€å·²è®¾ç½®ä¸ºæäº¤ä¸­');
            
            try {
                // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
                await new Promise(resolve => setTimeout(resolve, 2000));
                addLog('buttonLog', 'âœ… æäº¤å®Œæˆ');
            } catch (error) {
                addLog('buttonLog', `âŒ æäº¤å¤±è´¥: ${error.message}`);
            } finally {
                submitManager.setButtonSubmitting(button, false);
                addLog('buttonLog', 'ğŸ”„ æŒ‰é’®çŠ¶æ€å·²æ¢å¤');
            }
        }

        // æµ‹è¯•è¡¨å•é˜²é‡å¤æäº¤
        async function testFormSubmit(event, form) {
            event.preventDefault();
            addLog('formLog', `è¡¨å•æäº¤å¼€å§‹ - ç¬¬${++logCount}æ¬¡`);
            
            // åº”ç”¨é˜²é‡å¤æäº¤
            if (!submitManager.canSubmitForm(form)) {
                addLog('formLog', 'âŒ è¡¨å•è¢«é˜»æ­¢ï¼Œæ­£åœ¨æäº¤ä¸­...');
                return;
            }
            
            submitManager.setFormSubmitting(form, true);
            addLog('formLog', 'âœ… è¡¨å•å¼€å§‹æäº¤ï¼ŒçŠ¶æ€å·²è®¾ç½®ä¸ºæäº¤ä¸­');
            
            try {
                // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
                await new Promise(resolve => setTimeout(resolve, 2000));
                addLog('formLog', 'âœ… è¡¨å•æäº¤å®Œæˆ');
            } catch (error) {
                addLog('formLog', `âŒ è¡¨å•æäº¤å¤±è´¥: ${error.message}`);
            } finally {
                submitManager.setFormSubmitting(form, false);
                addLog('formLog', 'ğŸ”„ è¡¨å•çŠ¶æ€å·²æ¢å¤');
            }
        }

        // æµ‹è¯•åŠ è½½æç¤º
        async function testLoading(button) {
            addLog('loadingLog', 'å¼€å§‹æµ‹è¯•åŠ è½½æç¤º');
            
            // æµ‹è¯•å…¨å±€åŠ è½½æç¤º
            loadingManager.show('æ­£åœ¨å¤„ç†è¯·æ±‚...');
            addLog('loadingLog', 'âœ… å…¨å±€åŠ è½½æç¤ºå·²æ˜¾ç¤º');
            
            // æµ‹è¯•æŒ‰é’®åŠ è½½çŠ¶æ€
            loadingManager.setButtonLoading(button, true, 'åŠ è½½ä¸­...');
            addLog('loadingLog', 'âœ… æŒ‰é’®åŠ è½½çŠ¶æ€å·²è®¾ç½®');
            
            try {
                // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
                await new Promise(resolve => setTimeout(resolve, 2000));
                addLog('loadingLog', 'âœ… åŠ è½½å®Œæˆ');
            } catch (error) {
                addLog('loadingLog', `âŒ åŠ è½½å¤±è´¥: ${error.message}`);
            } finally {
                loadingManager.setButtonLoading(button, false);
                loadingManager.hide();
                addLog('loadingLog', 'ğŸ”„ åŠ è½½çŠ¶æ€å·²æ¢å¤');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('buttonLog', 'é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
            addLog('formLog', 'é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
            addLog('loadingLog', 'é¡µé¢åŠ è½½å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
        });
    </script>
</body>
</html>